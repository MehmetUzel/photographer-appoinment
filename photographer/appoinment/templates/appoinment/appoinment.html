{% extends 'homepage/base.html' %}
{% block title %}
Appoinment
{% endblock %}

{%block content%}
<h4>Randevu</h4>
<div style="text-align:center;">
<input type="submit" id='opp' value="Previous" onclick="previous()">
<input type="submit" id='opp' value="Next" onclick="next()">
</div>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <table>
        <thead>
          <tr>
            <th>
              <span class="long" id="monthl">Mart</span>
              <span class="short" id="months">Mart</span>
            </th>
            <th>
              <span class="day">1</span>
              <span class="long">Monday</span>
              <span class="short">Mon</span>
            </th>
            <th>
              <span class="day">2</span>
              <span class="long">Tuesday</span>
              <span class="short">Tue</span>
            </th>
            <th>
              <span class="day">3</span>
              <span class="long">Wednesday</span>
              <span class="short">We</span>
            </th>
            <th>
              <span class="day">4</span>
              <span class="long">Thursday</span>
              <span class="short">Thur</span>
            </th>
            <th>
              <span class="day">5</span>
              <span class="long">Friday</span>
              <span class="short">Fri</span>
            </th>
            <th>
              <span class="day">6</span>
              <span class="long">Saturday</span>
              <span class="short">Sat</span>
            </th>
            <th>
              <span class="day">7</span>
              <span class="long">Sunday</span>
              <span class="short">Sun</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr id="morning">
            <td class="hour" rowspan="1"><span>9:00</span></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>


          
          <tr id="noon">
            <td class="hour" rowspan="1"><span>14:00</span></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          
          <tr id="evening">
            <td class="hour" rowspan="1"><span>19:00</span></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>

          
        </tbody>
      </table>

{%endblock%}

{% block script %} 
<script>
    var current = -1
    var month = 0
    var data = JSON.parse("{{data|escapejs}}");
    var week_entry = JSON.parse("{{week|escapejs}}");
    var morning_row = document.getElementById("morning")
    var noon_row = document.getElementById("noon")
    var evening_row = document.getElementById("evening")


    const monthlist = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    var d = new Date();

    function next(){
        current += 1
        
        if (current == data[month].length) {
            month += 1
            current = 0
            if (month == data.length){
                month = 0
            }

        }
        
        change_values()
      
    }
    function previous(){
        current -= 1
        
        if (current <= -1) {
            month -= 1
            if (month <= -1){
                month = data.length-1
                current = data[month].length-1
            }
            else{
            current = data[month].length-1
            }
        }

        change_values()
      
    }

    function change_values(){
        clear_content_of_calendar()

        var d = new Date(data[month][current][3])
        var monthtext = monthlist[d.getMonth()];
        document.getElementById("monthl").innerHTML = monthtext + " "+d.getFullYear();
        document.getElementById("months").innerHTML = monthtext + " "+d.getFullYear();


        var monhml = `<h3>${monthtext}</h3>`

        var dayslist = document.getElementsByClassName("day");

        data[month][current].forEach(myFunction);

        function myFunction(value, index, arr) {
        var current_date = new Date(value)
        add_info_appoinment_offday(value)
        dayslist[index].innerHTML = current_date.getDate()	
        }
    }
    function clear_content_of_calendar(){
      for (let i = 1; i < 8; i++) { 
        morning_row.children[i].innerHTML = "";
        noon_row.children[i].innerHTML = "";
        evening_row.children[i].innerHTML = "";
        morning_row.children[i].style.backgroundColor = null;
        noon_row.children[i].style.backgroundColor = null;
        evening_row.children[i].style.backgroundColor = null;
      }
    }

    function add_info_appoinment_offday(day_to_fill){
        console.log("start")
        console.log(week_entry[day_to_fill])
        var dt = new Date(day_to_fill)
        console.log(day_to_fill)
        console.log(dt.getDay())
        var day_of_week = (((dt.getDay() +6) % 7))+1
        
        if (week_entry[day_to_fill]){
        week_entry[day_to_fill].forEach(add_to_cal);
        }
        function add_to_cal(day_slot) {
          console.log(day_of_week)

          if (day_slot.includes("OFF")){
            if (day_slot.includes("MO")){
                morning_row.children[day_of_week].innerHTML = "İZİN";
                morning_row.children[day_of_week].style.backgroundColor = 'blue';
            }
            else if (day_slot.includes("NO")){
              noon_row.children[day_of_week].innerHTML = "İZİN";
              noon_row.children[day_of_week].style.backgroundColor = 'blue';
            }
            else if (day_slot.includes("EV")){
              evening_row.children[day_of_week].innerHTML = "İZİN";
              evening_row.children[day_of_week].style.backgroundColor = 'blue';

            }
            else if (day_slot.includes("ALL")){
              morning_row.children[day_of_week].innerHTML = "İZİN";
              noon_row.children[day_of_week].innerHTML = "İZİN";
              evening_row.children[day_of_week].innerHTML = "İZİN";
              morning_row.children[day_of_week].style.backgroundColor = 'blue';
              noon_row.children[day_of_week].style.backgroundColor = 'blue';
              evening_row.children[day_of_week].style.backgroundColor = 'blue';


            }
          }
          else {
            if (day_slot.includes("MO")){
              morning_row.children[day_of_week].innerHTML = "DOLU";
              morning_row.children[day_of_week].style.backgroundColor = 'red';

            }
            else if (day_slot.includes("NO")){
              noon_row.children[day_of_week].innerHTML = "DOLU";
              noon_row.children[day_of_week].style.backgroundColor = 'red';

            }
            else if (day_slot.includes("EV")){
              evening_row.children[day_of_week].innerHTML = "DOLU";
              evening_row.children[day_of_week].style.backgroundColor = 'red';

            }
          } 
        }
        
        console.log("end")


    }
    
  </script>
  {%endblock%}

